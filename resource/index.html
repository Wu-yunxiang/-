<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>记账系统</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/dynamic-bg.css">
    <script src="scripts/app.js" defer></script>
    <script src="scripts/dynamic-effects.js" defer></script>
</head>
<body>
    <canvas id="dynamicBackground"></canvas>
    <div id="clickEffects"></div>
    <div id="app" aria-live="polite">
        <header class="app-header">
            <div class="title-group">
                <h1 id="pageTitle">记账系统</h1>
            </div>
        </header>

        <nav class="tab-bar" role="tablist">
            <button class="tab active" data-target="register" role="tab" aria-selected="true" data-hide-after-login="true">注册</button>
            <button class="tab" data-target="login" role="tab" data-hide-after-login="true">登录</button>
            <button class="tab" data-target="add" role="tab" data-requires-auth="true">记账</button>
            <button class="tab" data-target="search" role="tab" data-requires-auth="true">查询</button>
            <button class="tab" data-target="records" role="tab" data-requires-auth="true">交易记录</button>
        </nav>
        <!-- 用户状态显示已移除，页面标题仍会反映登录用户 -->

        <main>
            <section id="view-register" class="view active" role="tabpanel" data-hide-after-login="true">
                <h2>注册用户</h2>
                <form class="action-form" data-action="register" autocomplete="off">
                    <div class="field-row">
                        <label>用户名<input name="username" placeholder="必填" required></label>
                        <label>密码<input name="password" type="password" placeholder="必填" required></label>
                    </div>
                    <button type="submit" class="primary-btn">提交注册</button>
                </form>
            </section>

            <section id="view-login" class="view" role="tabpanel" data-hide-after-login="true">
                <h2>用户登录</h2>
                <form class="action-form" data-action="login" autocomplete="off">
                    <div class="field-row">
                        <label>用户名<input name="username" placeholder="必填" required></label>
                        <label>密码<input name="password" type="password" placeholder="必填" required></label>
                    </div>
                    <button type="submit" class="primary-btn">执行登录</button>
                </form>
            </section>

            <section id="view-add" class="view" role="tabpanel" data-requires-auth="true">
                <h2>新增账目</h2>
                <form class="action-form" data-action="add" autocomplete="off">
                    <div class="field-row">
                        <label>金额（￥）<input name="amount" type="number" step="0.01" min="0.01" placeholder="必填" required></label>
                        <label>日期（格式：2025/1/1）<input name="date" type="text" placeholder="必填" required aria-required="true"></label>
                        <label>类型（收入/支出）
                            <select name="type" required aria-required="true">
                                <!-- 占位提示已移除，首个选项作为默认值显示并提交 -->
                                <option value="income" selected>收入</option>
                                <option value="expense">支出</option>
                            </select>
                        </label>
                    </div>
                    <div class="field-row">
                        <label>用途<input name="subject" placeholder="可留空"></label>
                        <label>备注<input name="note" placeholder="可留空"></label>
                    </div>
                    <button type="submit" class="primary-btn">写入账本</button>
                </form>
            </section>

            <section id="view-search" class="view" role="tabpanel" data-requires-auth="true">
                <h2>查询账目</h2>
                <form class="action-form" data-action="search" autocomplete="off">
                    <div class="field-row">
                        <label>开始日期（格式：2025/1/1）<input name="startDate" type="text" placeholder="留空为不限"></label>
                        <label>截止日期（格式：2025/1/1）<input name="endDate" type="text" placeholder="留空为不限"></label>
                        <label>类型（不限/收入/支出）
                            <select name="type" data-keep-color>
                                <!-- 占位提示已移除，首个选项（不限）作为默认值显示并提交 -->
                                <option value="" selected>不限</option>
                                <option value="income">收入</option>
                                <option value="expense">支出</option>
                            </select>
                        </label>
                    </div>
                    <div class="field-row">
                        <label>最低金额（￥）<input name="minAmount" type="number" step="0.01" min="0" placeholder="留空为不限"></label>
                        <label>最高金额（￥）<input name="maxAmount" type="number" step="0.01" min="0" placeholder="留空为不限"></label>
                    </div>
                    <button type="submit" class="primary-btn">执行查询</button>
                </form>
                <div id="searchResult" class="search-result" hidden>
                    <header class="search-header">
                        <h3>查询结果</h3>
                        <select id="searchSortSelect" class="sort-select" aria-label="查询排序方式">
                            <option value="date-desc" selected>日期降序</option>
                            <option value="date-asc">日期升序</option>
                            <option value="amount-desc">金额降序</option>
                            <option value="amount-asc">金额升序</option>
                            <option value="type-income">收入在前</option>
                            <option value="type-expense">支出在前</option>
                        </select>
                    </header>
                    <!-- 新增：在查询结果上方居中显示统计 -->
                    <div id="searchTotalsDisplay" class="totals-row search-totals-display" aria-live="polite"></div>
                    <div class="summary" id="searchSummary"></div>
                    <table>
                        <thead>
                            <tr>
                                <th>用户</th>
                                <th>类型</th>
                                <th>金额（￥）</th>
                                <th>日期</th>
                                <th>用途</th>
                                <th>备注</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="searchTableBody"></tbody>
                        <tfoot>
                            <tr>
                                <td colspan="7" id="searchTotals" class="totals-row"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </section>

            <section id="view-records" class="view" role="tabpanel" data-requires-auth="true">
                <div class="records-header">
                    <div class="records-title-group">
                        <h2>交易记录</h2>
                        <span id="recordsCount" class="records-count">共 0 条记录</span>
                    </div>
                    <!-- 新增：在记录上方显示统计 -->
                    <div id="recordsTotalsDisplay" class="totals-row" aria-live="polite"></div>
                    <div class="records-actions">
                        <select id="recordsSortSelect" class="sort-select" aria-label="交易记录排序方式">
                            <option value="date-desc" selected>日期降序</option>
                            <option value="date-asc">日期升序</option>
                            <option value="amount-desc">金额降序</option>
                            <option value="amount-asc">金额升序</option>
                            <option value="type-income">收入在前</option>
                            <option value="type-expense">支出在前</option>
                        </select>
                        <button type="button" class="records-clear-btn" id="clearRecordsBtn" data-requires-auth="true">删除全部</button>
                        <button type="button" class="ghost-btn" id="refreshRecordsBtn">刷新</button>
                    </div>
                </div>
                <p id="recordsEmptyNotice" class="records-empty" hidden>暂无记录。提交账目后即可在此查看并删除。</p>
                <div id="recordsBoard" class="records-board" hidden>
                    <table>
                        <thead>
                            <tr>
                                <th>类型</th>
                                <th>金额（￥）</th>
                                <th>日期</th>
                                <th>用途</th>
                                <th>备注</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="recordsTableBody"></tbody>
                        <tfoot>
                            <tr>
                                <td colspan="6" id="recordsTotals" class="totals-row"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </section>
        </main>

        <!-- confirmOverlay moved out of #app so it's fixed to the viewport (user view) even when #app has transforms) -->

        <section class="console" aria-live="polite">
            <h2>操作日志</h2>
            <ul id="logPanel"></ul>
        </section>

        <!-- Footer removed per request: no prompts shown to users -->
    </div>
    <div id="confirmOverlay" class="confirm-overlay" hidden aria-hidden="true">
        <div class="confirm-dialog" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
            <h3 id="confirmTitle">确认操作</h3>
            <p id="confirmMessage">确定要执行此操作吗？</p>
            <div class="confirm-actions">
                <button type="button" class="primary-btn" data-confirm-ok>确认</button>
                <button type="button" class="ghost-btn dialog-cancel" data-confirm-cancel>取消</button>
            </div>
        </div>
    </div>
</body>
</html>
